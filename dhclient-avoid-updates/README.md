# Evitar actualizaciones al archivo resolv.conf por parte de dhclient

La siguiente guía tiene como propósito eliminar las actualizaciones generadas al archivo **/etc/resolv.conf** proveninetes de servicios como **dhclient** y **NetworkManager**.

## Prerequisitos

* Virtual CentOS/Rhel

## Desarrollo
*NOTA: Todos los comandos se corren como super usuario*

Cuando **/etc/resolv.conf** presenta un aspecto similar al siguiente:

```conf
; generated by /usr/sbin/dhclient-script
search backup.triara.local
nameserver 192.168.201.90
nameserver 192.168.201.89
```

Significa que es *dhclient* quien ha realizado las actualizaciones, para evitar esto generamos el archivo **/etc/dhcp/dhclient-enter-hooks**, sobreescribiendo la función encargad de actualizar el **/etc/resolv.conf**.

```bash
echo "IyEvYmluL2Jhc2gKbWFrZV9yZXNvbHZfY29uZigpIHsKZXhpdCAwCn0K" | base64 -d -w0 > /etc/dhcp/dhclient-enter-hooks
```

Le otorgamos permisos de ejecución al archivo creado anteriormente.

```bash
chmod a+x /etc/dhcp/dhclient-enter-hooks
```

Cuando **/etc/resolv.conf** presenta un aspecto similar al siguiente:

```conf
# Generated by NetworkManager
search amxga.net
nameserver 10.23.142.132
```

Significa que es el servicio de *NetworkManager* quien ha realizado las actualizaciones, para evitar esto realizamos lo siguiente:

En los archivos de configuración de red modificamos la línea **PEERDNS=yes** cambiandola a un estado de **PEERDNS=no** con esto indicamos que no se realicen actualizaciones al resolv.conf si se esta usando **dhcp**.

```bash
sed -i 's/PEERDNS=yes/PEERDNS=no/g' /etc/sysconfig/network-scripts/ifcfg-ens*
```

Enseguida le indicamos al servicio de NetworkManager que tampoco realice actualizaciones agregando la línea **dns=none** en la sección **[main]** del archivo **/etc/NetworkManager/NetworkManager.conf**

```bash
    sed -i 's/\[main\]/\[main\]\ndns=none/g' /etc/NetworkManager/NetworkManager.conf
```

Reiniciamos el servicio de *NetworkManager*

```bash
systemctl restart NetworkManager
```