#!/bin/bash
#####################################
#                                   #
#        Certificados Https         #
#                                   #
#####################################

# validacion de usuario
openssl genrsa 4096 > jitsi.key
openssl rsa -in jitsi.key -pubout

# Key del dominio
openssl genrsa 4096 > apps.videoconferenciaclaro.com.key

# CSR del wildcard
openssl req -new -sha256 -key apps.videoconferenciaclaro.com.key -subj "/" \
      -reqexts SAN -config <(cat /etc/pki/tls/openssl.cnf \
      <(printf "\n[SAN]\nsubjectAltName=DNS:apps.videoconferenciaclaro.com,DNS:*.apps.videoconferenciaclaro.com"))

# Aceptar terminos y condiciones
PRIV_KEY=./jitsi.key; echo -n "eyJ1cmwiOiJodHRwczovL2FjbWUtdjAyLmFwaS5sZXRzZW5jcnlwdC5vcmcvYWNtZS9uZXctYWNjdCIsImFsZyI6IlJTMjU2Iiwibm9uY2UiOiIwMDAxMlNiazdWMTVMb2pQRWwwQkZKZHJEUEQ5RnhvNU82T2tDNEZRNWhfM2tMcyIsImp3ayI6eyJlIjoiQVFBQiIsImt0eSI6IlJTQSIsIm4iOiIwWVhqRUhEc3prS05KSVNvb0dXYzhRR1VldGNNdUtZcGhBQllWaWZaUHRUWXZCNk42R096bEFQeTNJa2xWZHJydjliQ1lNaXA0MVpkeGkzT3Z3NWR1aUt0T2VzY2dhd0d3VDRVajRHR3Bza1hQcHNmN3VkVk9vV0UtQmFBNDJTNEFtN081VG5RNW1QUk4xN3htdEs4QWw1Q0RqcmpGOGdQd2xpcW1USWY3ckJoOTMyRWl5dXhOWndvdk9vLWYtTzNRNXVBRzFDZjVwdnNNVE90R1VmZ1l3Yk9DMVgzUDZYMkFMaTM4UjNBVmpGQ01JbElGcFA3bFU0UHBrNHo5aGdwTTNra3lSUXJPanV6TWpxZzJfLTR4S3ZGbzdxVWVxNHBlZ3VhS2RKY0xXcjlLekhsUjJSYmhHMmg0Z040MjItZ1FHNmVGcFF1eFVSS3hWZGplcHNSNDZPY0xHYXZ6UkJibHRnRkVpSFdxd1VtcHBGeld4S0tTNUE3TnVnWjRFQjdBMlA4SFFJTVAyY2lOYzlrOFlKTDUzVEM1RnhHdlZuYXVMWjQ1QlZYVGEzSEMzbnhYYWZqTW93a2hrVko4UENwX25LeWRaMUZKckoxLTI2RVpUbjZMdEdaMV9GOVpKSk1NbnVsMm0wQ0dPejhfMGUxS25DUm1IR3NMSE54SHYtdThKSF9UTXRfM3pxbnp3MUFlSmM4V0tRQXlTWVhwcURSWkhWUUNfdHh4NVhWRnFUQVlnMUoyc3RpUjRaY3d5Zmhwa182OTVxOTg5NkZMcC1oY09BRDBQcGVHVWxFQWxsZkRsejlJaHlOWjNIM21fUHNVTTJORnFocEl5aG1zeU5XeW5DSExUZi1hVF9RUFpaVURDZ0xzb24wV2ItT19CWlZ3Q09jYzR0QXg3RSJ9fQ.eyJ0ZXJtc09mU2VydmljZUFncmVlZCI6dHJ1ZX0" | openssl dgst -sha256 -hex -sign $PRIV_KEY
## Salida
# (stdin)= 5c139c9957233a019176c00df0dc10097f6afd4765a61a4c7299f6702de1aa53eb155fddbcc015ad977a815ee49b5f2298177027f95290b25870413179a66ade395894c0fc60dbaa53af36f9b6fbc195abec435013dda95612aefa0e0828af29bb70e13a05da49a8da477e9184a34e4695857b198619b66624820d3194a59cb6e4bb03f2ca75bfdb6ec9041eba2134c86a2087ce25ab9683175653df8b865bf2033df67e7df3e8ee00481aebac9a4917f0d3ab1a265317f06a38f6c058c15b2a904e40c81ae571009c58f5ae3ad956ce647e2b9a229f22ef5f279e9de0356cface59c2cd599af01be9300e5cbab660d56c79c8329923a3652ee971772ead2c18780d3ddbd1cd74a80e256297b561c78db482fcd19679bbc1ff566610db4ea1086b62607f057a50b4ea2fbec3d117bda652eb4a7d5c3e6117e42b7a4a150bad678e60feba526f71f072f1305a4c515c0d2116d1909dd32b36a7909c90e3bb3dd2f01aaa2efc179998b2b1cd790d628f45f401491df37c756f0c6f80db725e6669cd9d524b83b1567f2282928bccab711348a13d4ce387580e8e09537bce9c820ccfe2ded508761b894be2cac5d2f488d8b59c84c9f4004ade5882823b73fbf2a4052ecccaf98e192c0bb7dc907db7f45c1e0ca6ea0b29a0280b034a0a8c707b3891eabf7b4a4d4579b44ef288e22679e525434559ea74bc5e24b6864efa907cdb

# Actualizar correo
PRIV_KEY=./jitsi.key; echo -n "eyJ1cmwiOiJodHRwczovL2FjbWUtdjAyLmFwaS5sZXRzZW5jcnlwdC5vcmcvYWNtZS9hY2N0Lzg5NjU4NzUzIiwiYWxnIjoiUlMyNTYiLCJub25jZSI6IjAwMDJmbTAxWnhuY1RXSlRJZ3RGRmo5WDBkcHJqeGFuMWN5b3ZwMWdsMlBETm53Iiwia2lkIjoiaHR0cHM6Ly9hY21lLXYwMi5hcGkubGV0c2VuY3J5cHQub3JnL2FjbWUvYWNjdC84OTY1ODc1MyJ9.eyJjb250YWN0IjpbIm1haWx0bzprZXZpbi5nb21lekBhbXhpbmljaWF0aXZhcy5jb20iXX0" | openssl dgst -sha256 -hex -sign $PRIV_KEY
## Salida
# (stdin)= 6d81c34b457de3b057455f7b23e823b1a84304a34efad75569bf845066848cf08aac64b820d9fce59668cd4ee3705860cc4b5ecc4fcefc50dc2e7b2aa979551ae27d0e8931d68487b5bcd58b0fe7c0253e428255d7ff54903be7a14206e01942ac31e62763a12bd14689a4c0d4c001d9bead3d467d174efe08835b070fda8a6659a009977fbb7c73481d46dbdf5bf329e3e597a7e6c15dbbe42e47b548985237c687ff3c3892f7f81c26f4f41212f060204a13a6e2d8af137f2a01f49633ed01e59ec6500985194a31afc9aec9ed3be1984f5f395075a0a2c3cc0ea36cdef52ee83ae8ad43ffd4ff87d827588199aac84aa865d0cbade34df8fceb9446dd9e46e01603b157822d5acf371dfef1f6c2375d12266656d215dda4c97fa111e4d3f387c8f76793643c2ccf399cff51589c0f9bfda9cd0a74c376fc51e3e8d0e58fddcf314d89a180c2424647ddddcdd5c5c2fd2a1c3783f4bb76d794ae0d57db61783ac222d8b882f0c86837067fa86d43136dda06eed10b17ff517d3f57117b0745aee976f74c59552fbbea218ef5db59388b94fb55598e704311e73f5cea1fd4e7e490a75aa4ef973ac8abaf6356dfed15681527531a889cd034df34ed148a600d2c14f432ce088c959305fcb1fedc25f35e38d76d0ea01c66fbf72dd9a71a9532ffde15340ed4218cfbe8738dc406beaa5ab52841c75f34306cb548f170ea36b9

# Creacion solicitud de certificado
PRIV_KEY=./jitsi.key; echo -n "eyJ1cmwiOiJodHRwczovL2FjbWUtdjAyLmFwaS5sZXRzZW5jcnlwdC5vcmcvYWNtZS9uZXctb3JkZXIiLCJhbGciOiJSUzI1NiIsIm5vbmNlIjoiMDAwMjZQa2NkU0ZqS2xTUnRFOElyaWw2X2hUOGd3RXZhWThvN0JUcHh3MW9odmsiLCJraWQiOiJodHRwczovL2FjbWUtdjAyLmFwaS5sZXRzZW5jcnlwdC5vcmcvYWNtZS9hY2N0Lzg5NjU4NzUzIn0.eyJpZGVudGlmaWVycyI6W3sidHlwZSI6ImRucyIsInZhbHVlIjoiYXBwcy52aWRlb2NvbmZlcmVuY2lhY2xhcm8uY29tIn0seyJ0eXBlIjoiZG5zIiwidmFsdWUiOiIqLmFwcHMudmlkZW9jb25mZXJlbmNpYWNsYXJvLmNvbSJ9XX0" | openssl dgst -sha256 -hex -sign $PRIV_KEY
## Salida
# (stdin)= 5d5dd932ebe528998e838f0eeb490baaf480e92b4ee622b8f596b7ff2b5acbb9224d35fbb9166488fda63d818bd95725994e35bcef8795e10300130ff1170299505fbf8d84db4e23cada1b0f18ba35dc9f18eac852b447d354c65adff1a8c40ddaef6b27c922366f060f794e30c0b19c387b79dc9b393b55385b1a973cedb667e1a3a9a6dd0142d27eeea41126711f94b61d70a392303cd7e384ce988e2f4a7200bdac25d13b186e33f342edd3dac797d7f445ea95ca65d8d4d31038348b377f069ac0d1d3ab0cca1ffd8bbba6ad31fcb70733feb0ec9bf4e4c27e300cfb9c93af513b63fdcd2cecccc5a7a22ff95c8b1f5e14708581582d5efa5265475be64869cd41a97439ac1bc797721c4b19ec82b898e6211a5ddb0a68e3523fe0336762c423ee8b52f71b4614bc4540dda15ef3f6464a99d9c69daaf58aa68156947a638cd28a84961dc507968d0d4f9a3195893d29280b658c1af6e8f039e6de0785027b7a4a70b135a9d2d57e961087cc5b2200ae682a040c161a190da66a94c2aa12b072669f561ab8cc4bbb26c95ed3ccf12492e053636551fe043c7df40851d135924f2575fad455e350ebd3a54f1670a2a232813786ed5d5ff732ff2acd2ca47b8fc69ab43aa32c15931e8e19f1563202cdfbe1b2e12c2f9f9281787af15448c0fe2c67e5b5509e8a5f5f22f0325f8db99da4b3c5b76832aaf4e9777c0ae1d647

# Registros TXT
_acme-challenge.apps.videoconferenciaclaro.com
QLCp1DUS6dzF8Gy1CGzKe0f0TnWqtnPaNINW_f1-sLU

# Revision del registro
PRIV_KEY=./jitsi.key; echo -n "eyJ1cmwiOiJodHRwczovL2FjbWUtdjAyLmFwaS5sZXRzZW5jcnlwdC5vcmcvYWNtZS9jaGFsbC12My81NDUzNDA2NzQ2L01YZEo1USIsImFsZyI6IlJTMjU2Iiwibm9uY2UiOiIwMDAxQy1ndUR3ZG1kNDNkTTBKeDFKOEdBOG9sb3JpLWg0YzNTdi1YVlRIVWlLdyIsImtpZCI6Imh0dHBzOi8vYWNtZS12MDIuYXBpLmxldHNlbmNyeXB0Lm9yZy9hY21lL2FjY3QvODk2NTg3NTMifQ.e30" | openssl dgst -sha256 -hex -sign $PRIV_KEY