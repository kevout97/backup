#!/bin/bash

DatabaseTransfertemplate="IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj
IyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgICAgICAgICAgICAgICAgICAgIFNjcmlwdGVkIGhlbHBl
ciBmaWxlICAgICAgICAgCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMj
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpjb21tdW5pdHkuRGF0YVNvdXJj
ZU5hbWU9d3BkYkRTX2NvbWRiCmNvbW11bml0eS5EYjMyS0J1ZmZlclBvb2xOYW1lPUJQMzJLMQpj
b21tdW5pdHkuRGI0S0J1ZmZlclBvb2xOYW1lPUJQMgpjb21tdW5pdHkuRGJDb25maWdSb2xlTmFt
ZT1XUF9CQVNFX0NPTkZJR19VU0VSUwpjb21tdW5pdHkuRGJJbmRleDRLQnVmZmVyUG9vbE5hbWU9
QlAzCmNvbW11bml0eS5EYk5hbWU9Y29tZGIKCmNvbW11bml0eS5EYk5vZGU9d3BzTm9kZQpjb21t
dW5pdHkuRGJQYXNzd29yZD1lQVFLcnU4RApjb21tdW5pdHkuRGJSdW50aW1lUm9sZU5hbWU9V1Bf
QkFTRV9SVU5USU1FX1VTRVJTCmNvbW11bml0eS5EYlNjaGVtYT1jb21tdW5pdHkKY29tbXVuaXR5
LkRiU3RvcmFnZUdyb3VwPVdQU1NHCmNvbW11bml0eS5EYlR5cGU9ZGIyCmNvbW11bml0eS5EYlVy
bD1qZGJjOmRiMjovL1JESUwwNy50bXgtaW50ZXJuYWNpb25hbC5uZXQ6NTEwMDAvY29tZGI6cmV0
dXJuQWxpYXM9MDsKY29tbXVuaXR5LkRiVXNlcj1kYjJ3cHM4CmNvbW11bml0eS5EYlZjYXQ9RFNO
OTEwCmNvbW11bml0eS5EYlZvbHVtZXM9Kgpjb21tdW5pdHkuVGFibGVzcGFjZURlZmluZT1OTwpj
b21tdW5pdHkuVGFibGVzcGFjZVRyYWNrTW9kPVlFUwoKCmN1c3RvbWl6YXRpb24uRGF0YVNvdXJj
ZU5hbWU9d3BkYkRTX2N1c3RkYgpjdXN0b21pemF0aW9uLkRiMzJLQnVmZmVyUG9vbE5hbWU9QlAz
MksxCmN1c3RvbWl6YXRpb24uRGI0S0J1ZmZlclBvb2xOYW1lPUJQMgpjdXN0b21pemF0aW9uLkRi
Q29uZmlnUm9sZU5hbWU9V1BfQkFTRV9DT05GSUdfVVNFUlMKY3VzdG9taXphdGlvbi5EYkluZGV4
NEtCdWZmZXJQb29sTmFtZT1CUDMKY3VzdG9taXphdGlvbi5EYk5hbWU9Y3VzZGIKCmN1c3RvbWl6
YXRpb24uRGJOb2RlPXdwc05vZGUKY3VzdG9taXphdGlvbi5EYlBhc3N3b3JkPWVBUUtydThECmN1
c3RvbWl6YXRpb24uRGJSdW50aW1lUm9sZU5hbWU9V1BfQkFTRV9SVU5USU1FX1VTRVJTCmN1c3Rv
bWl6YXRpb24uRGJTY2hlbWE9Y3VzdG9taXphdGlvbgpjdXN0b21pemF0aW9uLkRiU3RvcmFnZUdy
b3VwPVdQU1NHCmN1c3RvbWl6YXRpb24uRGJUeXBlPWRiMgpjdXN0b21pemF0aW9uLkRiVXJsPWpk
YmM6ZGIyOi8vUkRJTDA3LnRteC1pbnRlcm5hY2lvbmFsLm5ldDo1MTAwMC9jdXNkYjpyZXR1cm5B
bGlhcz0wOwpjdXN0b21pemF0aW9uLkRiVXNlcj1kYjJ3cHM4CmN1c3RvbWl6YXRpb24uRGJWY2F0
PURTTjkxMApjdXN0b21pemF0aW9uLkRiVm9sdW1lcz0qCmN1c3RvbWl6YXRpb24uVGFibGVzcGFj
ZURlZmluZT1OTwpjdXN0b21pemF0aW9uLlRhYmxlc3BhY2VUcmFja01vZD1ZRVMKCgpkYjIuRGJE
cml2ZXI9Y29tLmlibS5kYjIuamNjLkRCMkRyaXZlcgpkYjIuRGJMaWJyYXJ5PS9vcHQvSENML0Fw
cFNlcnZlci9kZXBsb3l0b29sL2l0cC9wbHVnaW5zL2NvbS5pYm0uZGF0YXRvb2xzLmRiMl8yLjIu
MjAwLnYyMDE1MDcyOF8yMzU0L2RyaXZlci9kYjJqY2M0Lmphcjovb3B0L0hDTC9BcHBTZXJ2ZXIv
ZGVwbG95dG9vbC9pdHAvcGx1Z2lucy9jb20uaWJtLmRhdGF0b29scy5kYjJfMi4yLjIwMC52MjAx
NTA3MjhfMjM1NC9kcml2ZXIvZGIyamNjX2xpY2Vuc2VfY3UuamFyCmRiMi5KZGJjUHJvdmlkZXJO
YW1lPXdwZGJKREJDX2RiMgpkZXJieS5EYkRyaXZlcj1vcmcuYXBhY2hlLmRlcmJ5LmpkYmMuRW1i
ZWRkZWREcml2ZXIKZGVyYnkuRGJMaWJyYXJ5PS9vcHQvSENML0FwcFNlcnZlci9kZXJieS9saWIv
ZGVyYnkuamFyCmRlcmJ5LkpkYmNQcm92aWRlck5hbWU9d3BkYkpEQkNfZGVyYnkKCmZlZWRiYWNr
LkRhdGFTb3VyY2VOYW1lPXdwZGJEU19mZGJrZGIKZmVlZGJhY2suRGIzMktCdWZmZXJQb29sTmFt
ZT1CUDMySzEKZmVlZGJhY2suRGI0S0J1ZmZlclBvb2xOYW1lPUJQMgpmZWVkYmFjay5EYkNvbmZp
Z1JvbGVOYW1lPVdQX1BaTl9DT05GSUdfVVNFUlMKZmVlZGJhY2suRGJIb3N0TmFtZT1teXNlcnZl
cgpmZWVkYmFjay5EYk5hbWU9ZmRia2RiCgpmZWVkYmFjay5EYk5vZGU9cHpuTm9kZQpmZWVkYmFj
ay5EYlBhc3N3b3JkPWVBUUtydThECmZlZWRiYWNrLkRiUnVudGltZVJvbGVOYW1lPVdQX1BaTl9S
VU5USU1FX1VTRVJTCmZlZWRiYWNrLkRiU2NoZW1hPUZFRURCQUNLCmZlZWRiYWNrLkRiU3RvcmFn
ZUdyb3VwPVdQU1NHCmZlZWRiYWNrLkRiVGFibGVzcGFjZT1mZGJrZGJ0cwpmZWVkYmFjay5EYlR5
cGU9ZGIyCmZlZWRiYWNrLkRiVXJsPWpkYmM6ZGIyOi8vUkRJTDA3LnRteC1pbnRlcm5hY2lvbmFs
Lm5ldDo1MTAwMC9mZGJrZGI6cmV0dXJuQWxpYXM9MDsKZmVlZGJhY2suRGJVc2VyPWRiMmFkbWlu
CmZlZWRiYWNrLkRiVmNhdD1EU045MTAKZmVlZGJhY2suRGJWb2x1bWVzPSoKCgpqY3IuYmxvYkJ1
ZmZlcnBvb2w9QlAzMksxCmpjci5EYXRhU291cmNlTmFtZT13cGRiRFNfamNyZGIKamNyLkRiMzJL
QnVmZmVyUG9vbE5hbWU9QlAzMksxCmpjci5EYjRLQnVmZmVyUG9vbE5hbWU9QlAyCmpjci5EYkNv
bmZpZ1JvbGVOYW1lPVdQX0pDUl9DT05GSUdfVVNFUlMKamNyLkRiRG9tYWluPXRlbG1leGludGVy
bmFjaW9uYWwubmV0Cmpjci5EYkhvc3Q9UmVwbGFjZVdpdGhZb3VyRGJIb3N0Cmpjci5EYkluZGV4
NEtCdWZmZXJQb29sTmFtZT1CUDMKamNyLkRiTmFtZT1qY3JkYgoKamNyLkRiTm9kZT13cHNOb2Rl
Cmpjci5EYlBhc3N3b3JkPWVBUUtydThECmpjci5EYlBvcnQ9NDQ2Cmpjci5EYlJ1bnRpbWVSb2xl
TmFtZT1XUF9KQ1JfUlVOVElNRV9VU0VSUwpqY3IuRGJTY2hlbWE9amNyCmpjci5EYlN0b3JhZ2VH
cm91cD1XUFNTRwpqY3IuRGJUeXBlPWRiMgpqY3IuRGJVcmw9amRiYzpkYjI6Ly9SRElMMDcudG14
LWludGVybmFjaW9uYWwubmV0OjUxMDAwL2pjcmRiOnJldHVybkFsaWFzPTA7Cmpjci5EYlVzZXI9
ZGIyd3BzOApqY3IuRGJWY2F0PURTTjkxMApqY3IuRGJWb2x1bWVzPSoKamNyLlRhYmxlc3BhY2VE
ZWZpbmU9Tk8KamNyLlRhYmxlc3BhY2VUcmFja01vZD1ZRVMKamNyLlpvc0RiTWF4VGFibGVzPTEw
MApqY3IuWm9zRGJQcmVmaXg9SUNNCgpsaWtlbWluZHMuRGF0YVNvdXJjZU5hbWU9d3BkYkRTCmxp
a2VtaW5kcy5EYjMyS0J1ZmZlclBvb2xOYW1lPUJQMzJLMQpsaWtlbWluZHMuRGI0S0J1ZmZlclBv
b2xOYW1lPUJQMgpsaWtlbWluZHMuRGJDb25maWdSb2xlTmFtZT1XUF9QWk5fQ09ORklHX1VTRVJT
Cmxpa2VtaW5kcy5EYkhvc3ROYW1lPW15c2VydmVyCmxpa2VtaW5kcy5EYk5hbWU9bG1kYgoKbGlr
ZW1pbmRzLkRiTm9kZT1wem5Ob2RlCmxpa2VtaW5kcy5EYlBhc3N3b3JkPWVBUUtydThECmxpa2Vt
aW5kcy5EYlJ1bnRpbWVSb2xlTmFtZT1XUF9QWk5fUlVOVElNRV9VU0VSUwpsaWtlbWluZHMuRGJT
Y2hlbWE9bGlrZW1pbmRzCmxpa2VtaW5kcy5EYlN0b3JhZ2VHcm91cD1XUFNTRwpsaWtlbWluZHMu
RGJUYWJsZXNwYWNlPWxtZGJ0cwpsaWtlbWluZHMuRGJUeXBlPWRiMgpsaWtlbWluZHMuRGJVcmw9
amRiYzpkYjI6Ly9SRElMMDcudG14LWludGVybmFjaW9uYWwubmV0OjUxMDAwL2xtZGI6cmV0dXJu
QWxpYXM9MDsKbGlrZW1pbmRzLkRiVXNlcj1kYjJ3cHM4Cmxpa2VtaW5kcy5EYlZjYXQ9RFNOOTEw
Cmxpa2VtaW5kcy5EYlZvbHVtZXM9KgoKcmVsZWFzZS5EYXRhU291cmNlTmFtZT13cGRiRFNfcmVs
ZGIKcmVsZWFzZS5EYjMyS0J1ZmZlclBvb2xOYW1lPUJQMzJLMQpyZWxlYXNlLkRiNEtCdWZmZXJQ
b29sTmFtZT1CUDIKcmVsZWFzZS5EYkNvbmZpZ1JvbGVOYW1lPVdQX0JBU0VfQ09ORklHX1VTRVJT
CnJlbGVhc2UuRGJJbmRleDRLQnVmZmVyUG9vbE5hbWU9QlAzCnJlbGVhc2UuRGJOYW1lPXJlbGRi
CgpyZWxlYXNlLkRiTm9kZT13cHNOb2RlCnJlbGVhc2UuRGJQYXNzd29yZD1lQVFLcnU4RApyZWxl
YXNlLkRiUnVudGltZVJvbGVOYW1lPVdQX0JBU0VfUlVOVElNRV9VU0VSUwpyZWxlYXNlLkRiU2No
ZW1hPXJlbGVhc2UKcmVsZWFzZS5EYlN0b3JhZ2VHcm91cD1XUFNTRwpyZWxlYXNlLkRiVHlwZT1k
YjIKcmVsZWFzZS5EYlVybD1qZGJjOmRiMjovL1JESUwwNy50bXgtaW50ZXJuYWNpb25hbC5uZXQ6
NTEwMDAvcmVsZGI6cmV0dXJuQWxpYXM9MDsKcmVsZWFzZS5EYlVzZXI9ZGIyd3BzOApyZWxlYXNl
LkRiVmNhdD1EU045MTAKcmVsZWFzZS5EYlZvbHVtZXM9KgpyZWxlYXNlLlRhYmxlc3BhY2VEZWZp
bmU9Tk8KcmVsZWFzZS5UYWJsZXNwYWNlVHJhY2tNb2Q9WUVTCldhc1Bhc3N3b3JkPXdwYWRtaW5f
cmVsZGI="

echo "${DatabaseTransfertemplate}" | base64 -d > DatabaseTransfer.template

cp /opt/HCL/AppServer/universalDriver/lib/db2jcc_license_cu.jar /opt/HCL/AppServer/deploytool/itp/plugins/com.ibm.datatools.db2_2.2.200.v20150728_2354/driver/

USER=db2amx
PASW=mipasswordmuysecreto
HOST="10.23.142.134"
PORT=50000
DWASPWD=wpsadmin

sed -e "s/\(.*.DbUser=\).*/\1$USER/" \
    -e "s/\(.*.DbPassword=\).*/\1$PASW/" \
    -e "s/feedback.DbUrl=.*/feedback.DbUrl=jdbc:db2:\/\/$HOST:$PORT\/fdbkdb:returnAlias=0;/" \
    -e "s/jcr.DbUrl=.*/jcr.DbUrl=jdbc:db2:\/\/$HOST:$PORT\/jcrdb:returnAlias=0;/" \
    -e "s/community.DbUrl=.*/community.DbUrl=jdbc:db2:\/\/$HOST:$PORT\/comdb:returnAlias=0;/" \
    -e "s/release.DbUrl=.*/release.DbUrl=jdbc:db2:\/\/$HOST:$PORT\/reldb:returnAlias=0;/" \
    -e "s/customization.DbUrl=.*/customization.DbUrl=jdbc:db2:\/\/$HOST:$PORT\/cusdb:returnAlias=0;/" \
    -e "s/likeminds.DbUrl=.*/likeminds.DbUrl=jdbc:db2:\/\/$HOST:$PORT\/lmdb:returnAlias=0;/" \
    DatabaseTransfer.template > DatabaseTransfer.properties

/opt/HCL/wp_profile/ConfigEngine/ConfigEngine.sh  -DSaveParentProperties=false -DparentProperties="DatabaseTransfer.properties" -DWasPassword=${DWASPWD} -DTransferDomainList=feedback,likeminds,release,community,customization,jcr validate-database

TASK_RC=$?

echo TASK_RC: $TASK_RC

if [ $TASK_RC -eq 0 ]; then
        /opt/HCL/wp_profile/ConfigEngine/ConfigEngine.sh  -DSaveParentProperties=true -DparentProperties="DatabaseTransfer.properties" -DWasPassword=${DWASPWD} -DTransferDomainList=feedback,likeminds,release,community,customization,jcr -DuseCustomTablespaceMapping=false database-transfer
fi